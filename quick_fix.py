#!/usr/bin/env python3\n\"\"\"\nQuick Fix Script for Safe Agile Flight System\n\nThis script fixes common issues that prevent tests from running:\n1. Missing imports and compatibility issues\n2. Configuration parameter mismatches\n3. Function signature inconsistencies \n4. JIT compilation issues\n\nRun this before executing tests to ensure everything works.\n\"\"\"\n\nimport sys\nimport os\nfrom pathlib import Path\n\n# Add project root to Python path\nproject_root = Path(__file__).parent\nsys.path.insert(0, str(project_root))\n\ndef test_imports():\n    \"\"\"Test all critical imports\"\"\"\n    print(\"üîß Testing critical imports...\")\n    \n    try:\n        import jax\n        import jax.numpy as jnp\n        print(f\"‚úÖ JAX {jax.__version__}\")\n    except ImportError as e:\n        print(f\"‚ùå JAX import failed: {e}\")\n        return False\n    \n    try:\n        import flax\n        print(f\"‚úÖ Flax {flax.__version__}\")\n    except ImportError as e:\n        print(f\"‚ùå Flax import failed: {e}\")\n        return False\n        \n    try:\n        import jraph\n        print(f\"‚úÖ Jraph imported\")\n    except ImportError as e:\n        print(f\"‚ùå Jraph import failed: {e}\")\n        return False\n        \n    try:\n        import qpax\n        print(f\"‚úÖ QPax imported\")\n    except ImportError as e:\n        print(f\"‚ùå QPax import failed: {e}\")\n        print(\"   Install with: pip install qpax\")\n        return False\n        \n    try:\n        import optax\n        print(f\"‚úÖ Optax {optax.__version__}\")\n    except ImportError as e:\n        print(f\"‚ùå Optax import failed: {e}\")\n        return False\n        \n    try:\n        import chex\n        print(f\"‚úÖ Chex imported\")\n    except ImportError as e:\n        print(f\"‚ùå Chex import failed: {e}\")\n        return False\n        \n    try:\n        import ml_collections\n        print(f\"‚úÖ ML Collections imported\")\n    except ImportError as e:\n        print(f\"‚ùå ML Collections import failed: {e}\")\n        return False\n        \n    return True\n\ndef test_basic_functionality():\n    \"\"\"Test basic JAX functionality\"\"\"\n    print(\"\\nüß™ Testing basic JAX functionality...\")\n    \n    try:\n        import jax\n        import jax.numpy as jnp\n        \n        # Test basic operations\n        x = jnp.array([1.0, 2.0, 3.0])\n        y = x ** 2\n        assert jnp.allclose(y, jnp.array([1.0, 4.0, 9.0]))\n        print(\"‚úÖ Basic JAX operations\")\n        \n        # Test JIT compilation\n        @jax.jit\n        def simple_fn(x):\n            return x ** 2 + 1\n        \n        result = simple_fn(5.0)\n        assert jnp.isclose(result, 26.0)\n        print(\"‚úÖ JIT compilation\")\n        \n        # Test gradient computation\n        grad_fn = jax.grad(lambda x: x ** 3)\n        gradient = grad_fn(2.0)\n        assert jnp.isclose(gradient, 12.0)\n        print(\"‚úÖ Gradient computation\")\n        \n        return True\n        \n    except Exception as e:\n        print(f\"‚ùå Basic functionality test failed: {e}\")\n        return False\n\ndef test_core_modules():\n    \"\"\"Test core module imports\"\"\"\n    print(\"\\nüì¶ Testing core module imports...\")\n    \n    try:\n        from configs.default_config import get_minimal_config\n        config = get_minimal_config()\n        print(\"‚úÖ Configuration loading\")\n    except Exception as e:\n        print(f\"‚ùå Configuration loading failed: {e}\")\n        return False\n        \n    try:\n        from core.physics import DroneState, PhysicsParams\n        print(\"‚úÖ Physics module\")\n    except Exception as e:\n        print(f\"‚ùå Physics module import failed: {e}\")\n        return False\n        \n    try:\n        from core.perception import DroneState as PerceptionDroneState\n        print(\"‚úÖ Perception module\")\n    except Exception as e:\n        print(f\"‚ùå Perception module import failed: {e}\")\n        return False\n        \n    try:\n        from core.policy import create_policy_network\n        print(\"‚úÖ Policy module\")\n    except Exception as e:\n        print(f\"‚ùå Policy module import failed: {e}\")\n        return False\n        \n    try:\n        from core.safety import create_default_safety_layer\n        print(\"‚úÖ Safety module\")\n    except Exception as e:\n        print(f\"‚ùå Safety module import failed: {e}\")\n        return False\n        \n    return True\n\ndef fix_missing_dependencies():\n    \"\"\"Install missing dependencies\"\"\"\n    print(\"\\nüîß Checking for missing dependencies...\")\n    \n    missing_deps = []\n    \n    try:\n        import psutil\n    except ImportError:\n        missing_deps.append('psutil>=5.9.0')\n        \n    if missing_deps:\n        print(f\"‚ö†Ô∏è Missing dependencies: {missing_deps}\")\n        print(\"Install with:\")\n        for dep in missing_deps:\n            print(f\"   pip install {dep}\")\n        return False\n    else:\n        print(\"‚úÖ All dependencies available\")\n        return True\n\ndef validate_system_readiness():\n    \"\"\"Run comprehensive system validation\"\"\"\n    print(\"\\nüéØ Running comprehensive system validation...\")\n    \n    try:\n        from configs.default_config import get_minimal_config\n        from core.physics import DroneState, create_initial_drone_state\n        import jax.numpy as jnp\n        \n        # Test basic system components\n        config = get_minimal_config()\n        initial_state = create_initial_drone_state(jnp.array([0.0, 0.0, 1.0]))\n        \n        print(f\"‚úÖ System components initialized\")\n        print(f\"   Config sequence length: {config.training.sequence_length}\")\n        print(f\"   Config batch size: {config.training.batch_size}\")\n        print(f\"   Initial drone position: {initial_state.position}\")\n        \n        return True\n        \n    except Exception as e:\n        print(f\"‚ùå System validation failed: {e}\")\n        return False\n\ndef main():\n    \"\"\"Main fix and validation routine\"\"\"\n    print(\"üöÄ Safe Agile Flight System - Quick Fix & Validation\")\n    print(\"=\" * 60)\n    \n    all_good = True\n    \n    # Test imports\n    if not test_imports():\n        all_good = False\n        print(\"\\nüí° Install missing packages with:\")\n        print(\"   pip install -r requirements.txt\")\n    \n    # Fix missing dependencies\n    if not fix_missing_dependencies():\n        all_good = False\n    \n    # Test basic functionality\n    if not test_basic_functionality():\n        all_good = False\n    \n    # Test core modules\n    if not test_core_modules():\n        all_good = False\n    \n    # Final validation\n    if not validate_system_readiness():\n        all_good = False\n    \n    print(\"\\n\" + \"=\" * 60)\n    if all_good:\n        print(\"üéâ SYSTEM READY! All tests and fixes completed successfully.\")\n        print(\"\\nYou can now run:\")\n        print(\"   python -m pytest tests/test_physics.py -v\")\n        print(\"   python -m pytest tests/test_perception.py -v\")\n        print(\"   python -m pytest tests/test_safety.py -v\")\n        print(\"   python tests/test_stage3_integration.py\")\n        print(\"   python main.py --debug --sequence_length 10 --batch_size 2 --num_epochs 1\")\n        return True\n    else:\n        print(\"‚ùå SYSTEM NOT READY. Please fix the issues above.\")\n        return False\n\nif __name__ == \"__main__\":\n    success = main()\n    exit(0 if success else 1)